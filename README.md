# figma-to-react

**Figma 디자인 → React 컴포넌트 자동 변환 도구**

Figma의 컴포넌트와 디자인 토큰을 분석해 TypeScript + React 코드를 자동으로 생성합니다.

## 특징

- **다중 스타일 어댑터** — Tailwind CSS, CSS Modules, Styled-Components, Emotion 지원
- **Storybook 연동** — `.stories.tsx` 파일 자동 생성 (CSF 3.0)
- **디자인 토큰 추출** — Figma Variables → `theme.ts`, CSS 변수, Tailwind config 생성
- **Watch 모드** — Figma Plugin과 SSE로 실시간 연동
- **사용자 코드 보존** — 재생성 시 `@f2r-user-start` 마커로 수동 수정 유지
- **TypeScript 완전 지원** — 모든 출력 파일에 타입 안전 코드 생성

## 설치

```bash
npm install -g figma-to-react
# 또는
npx figma-to-react init
```

## 빠른 시작

```bash
# 1. 설정 파일 생성
f2r init

# 2. FIGMA_TOKEN 환경변수 설정
export FIGMA_TOKEN=your_personal_access_token

# 3. 변환 실행
f2r convert
```

## CLI 커맨드

### `f2r init`

`figma2react.config.yml` 설정 파일 생성.

```bash
f2r init         # 새 설정 파일 생성
f2r init --force # 기존 파일 덮어쓰기
```

### `f2r convert`

Figma 컴포넌트를 React 파일로 변환.

```bash
f2r convert                          # 전체 변환 (config 기반)
f2r convert --node=123:456           # 특정 노드만
f2r convert --style=tailwind         # 스타일 어댑터 지정
f2r convert --out=./src/components   # 출력 디렉토리 지정
f2r convert --stories                # Storybook stories 함께 생성
f2r convert --dry-run                # 파일 생성 없이 미리보기
```

**출력 예시:**
```
figma-to-react 변환 시작
→ Figma File: abc123def456
→ 스타일 어댑터: tailwind
→ 출력 디렉토리: ./src/components
→ 컴포넌트 노드 파싱 중...
→ 파싱 완료: 14개 컴포넌트

✅ Button/Button.tsx 생성 완료
✅ Button/types.ts 생성 완료
✅ Button/index.ts 생성 완료
✅ Button/Button.stories.tsx 생성 완료
⚠️ Card/Hero: absolute layout 감지 → position: absolute 사용
✅ Card/Card.tsx 생성 완료

완료: 14/14 컴포넌트 | 경고: 1 | 실패: 0
```

### `f2r tokens`

Figma Variables에서 디자인 토큰 추출.

```bash
f2r tokens             # theme.ts 생성
f2r tokens --css       # CSS 변수 파일도 생성
f2r tokens --tailwind  # tailwind.config.ts 생성
```

### `f2r watch`

로컬 서버를 시작하고 Figma Plugin과 연동.

```bash
f2r watch                      # 서버 시작 (포트 3131)
f2r watch --port=3200          # 포트 지정
f2r watch --poll               # REST API 폴링 모드
f2r watch --poll --interval=60 # 60초마다 Figma 확인
```

## 설정 파일

`figma2react.config.yml`:

```yaml
figma:
  token: ${FIGMA_TOKEN}      # 환경변수 참조
  fileKey: "abc123def456"   # Figma URL의 /design/<여기>/...

output:
  dir: "./src/components"
  style: "tailwind"          # tailwind | css-modules | styled-components | emotion
  typescript: true
  stories: false
  indexBarrel: true

theme:
  extract: true
  output: "./src/tokens/theme.ts"
  tailwindConfig: "./tailwind.config.ts"

naming:
  components: "PascalCase"
  files: "kebab-case"

# 노드 이름 → HTML 태그 강제 매핑
tags:
  "Button*": "button"
  "Link*": "a"
  "Input*": "input"
```

## 출력 구조

```
src/components/
├── Button/
│   ├── Button.tsx            # 컴포넌트 구현
│   ├── types.ts              # Props 타입 정의
│   ├── index.ts              # barrel export
│   └── Button.stories.tsx    # Storybook (--stories 옵션)
├── Card/
│   ├── Card.tsx
│   ├── Card.module.css       # CSS Modules 어댑터 사용 시
│   ├── types.ts
│   └── index.ts
└── index.ts                  # 전체 barrel
```

**생성되는 컴포넌트 예시 (Tailwind):**

```tsx
// Generated by figma-to-react — Do not edit manually
// Figma: abc123def456

import type { ButtonProps } from './types';

export function Button({ className, ...props }: ButtonProps) {
  return (
    <button className="flex flex-row items-center justify-center gap-2 px-5 py-3 rounded-lg bg-blue-500">
      <span className="text-base font-semibold text-white">{props.label}</span>
    </button>
  );
}
```

**생성되는 타입 예시:**

```ts
// types.ts
export interface ButtonProps {
  className?: string;
  variant?: 'primary' | 'secondary' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  label?: string;
  children?: React.ReactNode;
}
```

## 사용자 코드 보존

재생성 시 수동으로 작성한 코드를 보존하려면 `@f2r-user-start` / `@f2r-user-end` 마커를 사용:

```tsx
// Button.tsx

export function Button({ className, variant, label }: ButtonProps) {
  return (
    <button className={getVariantClass(variant)}>
      {label}
    </button>
  );
}

// @f2r-user-start customLogic
// 이 블록은 재생성 시에도 보존됩니다
export const getVariantClass = (v?: string) =>
  v === 'primary' ? 'bg-blue-500' : 'bg-gray-200';
// @f2r-user-end
```

## Figma Plugin 연동

1. Figma Desktop에서 플러그인 설치
2. `f2r watch` 로 로컬 서버 시작
3. Figma에서 컴포넌트 수정 → 플러그인이 자동으로 POST `/convert` 호출
4. React 파일 즉시 업데이트

### 서버 API

| 엔드포인트 | 메서드 | 설명 |
|---|---|---|
| `/health` | GET | 서버 상태 확인 |
| `/convert` | POST | IR 수신 → 파일 생성 |
| `/preview` | POST | 코드 미리보기 (파일 미생성) |
| `/watch` | GET | SSE 실시간 이벤트 스트림 |
| `/watch/start` | POST | Watch 모드 시작 |
| `/watch/stop` | POST | Watch 모드 중지 |

## Figma 레이어 네이밍 컨벤션

변환 품질을 높이려면 Figma 레이어 이름 규칙을 따르세요:

```
# 기본 컴포넌트
Button/Primary/Large      → <Button variant="primary" size="large" />
Card/Default              → <Card />

# Props 추출
[prop:label]              → label prop
[prop:description]        → description prop

# Children 슬롯
[slot]                    → {children}
[slot:icon]               → {icon}

# 무시할 레이어 (주석, 가이드)
_Guides                   → 변환 제외
```

## 스타일 어댑터 비교

| 어댑터 | 별도 파일 | 토큰 지원 | 특징 |
|---|---|---|---|
| `tailwind` | ❌ | ✅ | className 문자열, arbitrary fallback |
| `css-modules` | ✅ `.module.css` | ✅ | 클래스명 camelCase |
| `styled-components` | ❌ | ✅ | Template literal |
| `emotion` | ❌ | ✅ | `@emotion/styled` 또는 css prop |

## 개발

```bash
# 의존성 설치
pnpm install

# 테스트 실행
cd packages/core && npx vitest run

# 빌드
pnpm -r build

# 로컬 서버 실행
cd packages/server && npx ts-node src/index.ts
```

### 패키지 구조

```
figma-to-react/
├── packages/
│   ├── core/          # IR, Parser, Adapters, Generator
│   ├── plugin/        # Figma Plugin UI
│   ├── server/        # 로컬 HTTP 서버
│   └── n8n-nodes/     # n8n 커뮤니티 노드
├── cli/               # f2r CLI
└── workflows/         # n8n 워크플로우
```

## 라이선스

MIT

---

만든 사람: [@mje807](https://github.com/mje807) | 문서/이슈: [GitHub](https://github.com/mje807/figma-to-react)
